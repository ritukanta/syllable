<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SyllabusHub | Wayne Tech</title>
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='wayneGold' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23FFD700'/%3E%3Cstop offset='50%25' stop-color='%23DAA520'/%3E%3Cstop offset='100%25' stop-color='%23B8860B'/%3E%3C/linearGradient%3E%3Cfilter id='glow'%3E%3CfeDropShadow dx='0' dy='0' stdDeviation='10' flood-color='%23FFD700' flood-opacity='0.5'/%3E%3C/filter%3E%3C/defs%3E%3Cpath fill='url(%23wayneGold)' filter='url(%23glow)' d='M488.6 183.9c-15.6-5.2-34.6-10.4-56.2-12.5-20.8-2.1-39.6-3.1-39.6-3.1s5.2-9.4 11.5-21.9c9.4-18.7 14.6-40.6 0-61.4-3.1-4.2-10.4-12.5-25-14.6-5.2-0.7-11.5 0-16.7 2.1-7.3 3.1-13.5 10.4-16.7 16.7-6.2 14.6-8.3 29.1-8.3 29.1s-14.6-5.2-27.1-7.3c-10.4-1.6-20.8-2.1-31.2-2.1-10.4 0-20.8 0.5-31.2 2.1-12.5 2.1-27.1 7.3-27.1 7.3s-2.1-14.6-8.3-29.1c-3.1-6.2-9.4-13.5-16.7-16.7-5.2-2.1-11.5-2.8-16.7-2.1-14.6 2.1-21.9 10.4-25 14.6-14.6 20.8-9.4 42.7 0 61.4 6.2 12.5 11.5 21.9 11.5 21.9s-18.7 1-39.6 3.1c-21.6 2.1-40.6 7.3-56.2 12.5C49.3 191.2 50 210 61.8 225.6c10.4 13.5 35.4 36.4 61.4 59.3 24 20.8 60.4 46.8 92.6 63.5 18.7 9.4 46.8 20.8 46.8 20.8s18.7-18.7 35.4-33.3c16.7-14.6 41.6-39.6 41.6-39.6s-9.4 11.5-16.7 28.1-6.2 15.6-11.5 38.5 8.3 47.9c13.5 6.2 27.1 4.2 36.4-3.1 7.3-5.2 13.5-14.6 18.7-25 8.3-16.7 16.7-41.6 16.7-41.6s10.4 26 16.7 41.6 5.2 10.4 11.5 19.8 18.7 25 9.4 7.3 22.9 9.4 36.4 3.1 19.8-9.4 14.6-32.3 8.3-47.9-7.3-16.7-16.7-28.1-16.7-28.1 25 25 41.6 39.6c16.7 14.6 35.4 33.3 35.4 33.3s28.1-11.5 46.8-20.8c32.3-16.7 68.7-42.7 92.6-63.5 26-22.9 51-45.8 61.4-59.3C512 210 504.2 189.1 488.6 183.9z'/%3E%3C/svg%3E"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Lenis for Butter Smooth Scrolling -->
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              background: "var(--bg-main)",
              surface: "var(--bg-surface)",
              surfaceHighlight: "var(--bg-surface-highlight)",
              border: "var(--border-color)",
              text: "var(--text-main)",
              textMuted: "var(--text-muted)",
              primary: "var(--primary)",
              gold: "var(--gold)",
              silver: "var(--silver)",
            },
            boxShadow: {
              glow: "0 0 20px -5px var(--glow-color)",
              silverGlow: "0 0 35px -5px var(--silver-glow)",
              goldGlow: "0 0 30px -5px var(--gold-glow)",
            },
            animation: {
              "spin-slow": "spin 3s linear infinite",
            },
          },
        },
      };
    </script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wght@400;700&display=swap");

      body {
        font-family: "Outfit", sans-serif;
        transition: background-color 0.4s ease, color 0.4s ease;
        background-color: var(--bg-main);
        color: var(--text-main);
      }
      .odia-text {
        font-family: "Noto Sans Oriya", sans-serif;
      }

      /* --- THEME VARIABLES --- */
      :root {
        /* Light Theme (Clean Tech) */
        --bg-main: #f0f4f8;
        --bg-surface: rgba(255, 255, 255, 0.85);
        --bg-surface-highlight: #f8fafc;
        --border-color: #e2e8f0;
        --text-main: #1e293b;
        --text-muted: #64748b;
        --primary: #d4af37; /* Metallic Gold */
        --gold: #d4af37;
        --silver: #94a3b8;
        --glow-color: rgba(212, 175, 55, 0.4);
        --silver-glow: rgba(148, 163, 184, 0.7);
        --gold-glow: rgba(212, 175, 55, 0.6);
        --backdrop: 12px;
      }

      [data-theme="dark"] {
        /* Dark Theme (Wayne Tech) */
        --bg-main: #050505;
        --bg-surface: rgba(20, 20, 20, 0.65);
        --bg-surface-highlight: rgba(255, 255, 255, 0.05);
        --border-color: #333333;
        --text-main: #e2e2e2;
        --text-muted: #a3a3a3;
        --primary: #ffd700; /* Bright Gold */
        --gold: #ffd700;
        --silver: #c0c0c0;
        --glow-color: rgba(255, 215, 0, 0.3);
        --silver-glow: rgba(192, 192, 192, 0.6);
        --gold-glow: rgba(255, 215, 0, 0.5);
        --backdrop: 20px;
      }

      /* Utilities */
      ::-webkit-scrollbar {
        height: 4px;
        width: 4px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary);
      }

      /* Glassmorphism */
      .glass-panel {
        background: var(--bg-surface);
        backdrop-filter: blur(var(--backdrop));
        -webkit-backdrop-filter: blur(var(--backdrop));
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      /* PERFORMANCE OPTIMIZATIONS FOR SMOOTHNESS */
      .hover-card-effect {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        z-index: 1;
        border: 1px solid var(--border-color);
        /* Hardware Acceleration Hints */
        will-change: transform, box-shadow;
        transform: translateZ(0);
      }
      .hover-card-effect:hover {
        transform: translateY(-4px);
        box-shadow: 0 0 35px var(--silver-glow);
        border-color: var(--silver);
        z-index: 10;
      }
      .hover-card-effect:active {
        transform: scale(0.99);
      }

      .card-gradient-header {
        position: relative;
        overflow: hidden;
      }
      .card-gradient-header::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.15) 0%,
          rgba(255, 255, 255, 0) 100%
        );
        pointer-events: none;
      }

      /* Collapsible Syllabus - BUTTER SMOOTH OPTIMIZATION */
      .syllabus-content {
        max-height: 0;
        overflow: hidden;
        /* Using a sophisticated cubic-bezier for a more natural, physics-based feel */
        transition: max-height 0.5s cubic-bezier(0.2, 0.8, 0.2, 1),
          opacity 0.4s ease;
        opacity: 0.8;
        /* Promote to layer for GPU rendering */
        will-change: max-height, opacity;
        transform: translateZ(0);
      }
      .syllabus-content.open {
        opacity: 1;
        /* max-height is set via JS */
      }
      .rotate-icon {
        transition: transform 0.4s ease;
      }
      .rotate-icon.open {
        transform: rotate(180deg);
      }

      /* Checkbox & Topic Styles */
      .topic-card {
        transition: all 0.2s ease;
        border: 1px solid transparent;
      }
      .topic-card:hover {
        border-color: var(--primary);
        background-color: var(--bg-surface-highlight);
        box-shadow: 0 0 15px -5px var(--gold-glow);
      }
      .topic-card.completed {
        border-left: 3px solid var(--primary);
        background-color: rgba(212, 175, 55, 0.05);
        opacity: 0.9;
      }
      .topic-card.completed .topic-text {
        text-decoration: line-through;
        color: var(--text-muted);
      }

      .custom-checkbox input:checked + div {
        background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);
        border-color: transparent;
        transform: scale(1.1);
        box-shadow: 0 0 10px var(--gold-glow);
        color: black;
      }

      /* Exam Pills */
      .exam-pill {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        background: var(--bg-surface);
        backdrop-filter: blur(5px);
      }
      .exam-pill:hover {
        box-shadow: 0 0 20px var(--silver-glow);
        border-color: var(--silver);
        color: var(--text-main);
      }
      .exam-pill.active {
        background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);
        color: black;
        border-color: transparent;
        box-shadow: 0 0 25px var(--gold-glow);
        font-weight: 700;
      }

      .animate-enter {
        animation: fadeInScale 0.5s cubic-bezier(0.16, 1, 0.3, 1);
      }
      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.98) translateY(10px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* Auth UI */
      .auth-btn {
        background: var(--bg-surface-highlight);
        border: 1px solid var(--border-color);
        color: var(--text-main);
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .auth-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        box-shadow: 0 0 15px var(--glow-color);
      }
    </style>
  </head>
  <body
    class="min-h-screen flex flex-col selection:bg-gold selection:text-black overflow-x-hidden"
  >
    <!-- Navbar -->
    <nav
      class="sticky top-0 z-50 border-b border-border bg-surface/80 backdrop-blur-xl transition-all duration-300"
      style="will-change: transform"
    >
      <div class="max-w-7xl mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3 group cursor-pointer">
            <div
              class="bg-gradient-to-br from-yellow-500 to-yellow-600 text-black w-10 h-10 flex items-center justify-center rounded-xl shadow-[0_0_15px_var(--gold-glow)] group-hover:shadow-[0_0_30px_var(--gold-glow)] transition-shadow duration-300"
            >
              <i class="fa-solid fa-layer-group text-lg"></i>
            </div>
            <h1 class="font-bold text-xl tracking-tight uppercase">
              Wayne<span class="text-primary">Tech</span>
              <span class="text-xs font-normal text-textMuted normal-case ml-1"
                >SyllabusHub</span
              >
            </h1>
          </div>

          <div class="flex items-center gap-4">
            <!-- Progress Bar (Desktop) -->
            <div
              id="header-progress"
              class="hidden md:block w-32 lg:w-48 group cursor-default"
            >
              <div
                class="flex justify-between text-xs font-bold text-textMuted mb-1 group-hover:text-primary transition-colors uppercase tracking-wider"
              >
                <span id="current-exam-label">Progress</span>
                <span id="progress-text">0%</span>
              </div>
              <div
                class="w-full bg-surfaceHighlight rounded-full h-1.5 border border-border overflow-hidden"
              >
                <div
                  id="progress-bar"
                  class="bg-gradient-to-r from-yellow-400 to-yellow-600 h-full rounded-full transition-all duration-700 ease-out shadow-[0_0_10px_var(--gold-glow)]"
                  style="width: 0%"
                ></div>
              </div>
            </div>

            <!-- Auth Container -->
            <div id="auth-container" class="flex items-center gap-2">
              <button id="login-btn" class="auth-btn glass-panel">
                <i class="fa-brands fa-google"></i>
                <span class="hidden sm:inline">Access</span>
              </button>
              <div id="user-profile" class="hidden flex items-center gap-3">
                <img
                  id="user-avatar"
                  src=""
                  alt="User"
                  class="w-9 h-9 rounded-full border-2 border-primary shadow-[0_0_15px_var(--gold-glow)]"
                />
                <button id="logout-btn" class="auth-btn" title="Logout">
                  <i class="fa-solid fa-right-from-bracket"></i>
                </button>
              </div>
            </div>

            <button
              onclick="toggleTheme()"
              class="w-9 h-9 rounded-full bg-surfaceHighlight border border-border flex items-center justify-center text-text hover:text-primary hover:border-primary hover:shadow-[0_0_15px_var(--glow-color)] transition-all focus:outline-none"
              title="Toggle Protocol"
            >
              <i
                id="theme-icon"
                class="fa-solid fa-moon text-sm transition-transform duration-500"
              ></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Exam Selector -->
    <div
      class="border-b border-border sticky top-[65px] z-40 transition-colors duration-300 backdrop-blur-md bg-background/80"
      style="will-change: transform"
    >
      <div class="max-w-7xl mx-auto px-4 py-4">
        <div
          id="exam-list"
          class="flex gap-3 overflow-x-auto pb-2 snap-x scrollbar-hide pt-2"
        ></div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 py-8 w-full">
      <div id="content-area"></div>
    </main>

    <!-- Footer -->
    <footer
      class="bg-surface/50 border-t border-border py-8 mt-auto backdrop-blur-sm"
    >
      <div class="text-center text-textMuted text-sm">
        <p class="font-bold uppercase tracking-widest text-xs">
          &copy; 2025 Wayne Enterprises
        </p>
        <p class="text-xs mt-2 opacity-60">
          <span id="sync-status"
            ><i class="fa-solid fa-circle-notch fa-spin"></i> Establishing
            Uplink...</span
          >
        </p>
      </div>
    </footer>

    <!-- TEMPLATES -->

    <!-- Empty State -->
    <template id="tmpl-empty">
      <div
        class="flex flex-col items-center justify-center py-24 text-center animate-enter"
      >
        <div
          class="w-24 h-24 bg-surfaceHighlight border border-border rounded-full flex items-center justify-center mb-6 shadow-[0_0_30px_var(--silver-glow)]"
        >
          <i class="fa-solid fa-fingerprint text-4xl text-textMuted/50"></i>
        </div>
        <h2 class="text-3xl font-bold mb-3 tracking-tight text-text">
          Restricted Area
        </h2>
        <p class="text-textMuted max-w-md mx-auto leading-relaxed">
          The tactical data for
          <span id="empty-exam-name" class="text-primary font-semibold"></span>
          is currently classified. Check back later.
        </p>
      </div>
    </template>

    <!-- Dashboard -->
    <template id="tmpl-dashboard">
      <div class="space-y-10 animate-enter">
        <!-- View Switcher -->
        <div
          class="flex justify-center bg-surface p-1.5 rounded-xl w-full md:w-max mx-auto border border-border shadow-lg"
        >
          <button
            onclick="switchView('pattern')"
            id="btn-pattern"
            class="flex-1 md:flex-none px-8 py-2.5 rounded-lg text-sm font-semibold transition-all"
          >
            Exam Pattern
          </button>
          <button
            onclick="switchView('syllabus')"
            id="btn-syllabus"
            class="flex-1 md:flex-none px-8 py-2.5 rounded-lg text-sm font-semibold transition-all"
          >
            Syllabus Tracker
          </button>
        </div>

        <!-- Pattern View -->
        <div id="view-pattern" class="space-y-8">
          <div id="pattern-container"></div>
        </div>

        <!-- Syllabus View -->
        <div id="view-syllabus" class="hidden space-y-8">
          <div
            class="flex items-center justify-between border-b border-border pb-4"
          >
            <div>
              <h3 class="font-bold text-2xl tracking-tight text-primary">
                Tactical Checklist
              </h3>
              <p class="text-textMuted text-sm mt-1">
                Monitor your preparation status
              </p>
            </div>
            <!-- Sync Indicator / Reset -->
            <div class="flex items-center gap-3">
              <span
                id="save-indicator"
                class="text-xs font-mono text-primary opacity-0 transition-opacity"
                >SAVED</span
              >
              <button
                onclick="resetCurrentProgress()"
                class="text-xs text-red-500 hover:text-red-400 font-medium transition px-3 py-1.5 rounded hover:bg-red-500/10 border border-transparent hover:border-red-500/20 hover:shadow-[0_0_10px_rgba(239,68,68,0.2)]"
              >
                <i class="fa-solid fa-rotate-right mr-1"></i> RESET
              </button>
            </div>
          </div>

          <!-- Auth Warning -->
          <div
            id="auth-warning"
            class="hidden bg-primary/10 border border-primary/20 text-primary p-4 rounded-xl text-sm flex items-center gap-3 shadow-[0_0_15px_var(--glow-color)]"
          >
            <i class="fa-solid fa-triangle-exclamation animate-pulse"></i>
            <span
              >Authenticate to sync your data with the Wayne Tech Cloud.</span
            >
          </div>

          <div class="space-y-8">
            <!-- Prelims Header -->
            <div id="syl-header-pre" class="hidden items-center gap-3 mb-4">
              <span
                id="syl-text-pre"
                class="px-4 py-1.5 rounded-md bg-surfaceHighlight text-text font-bold border border-border shadow-sm tracking-wide uppercase text-sm"
                >Phase 1</span
              >
              <div
                class="h-px bg-border flex-1 shadow-[0_0_5px_var(--silver-glow)]"
              ></div>
            </div>
            <!-- FIXED: Added items-start to prevent adjacent card stretching -->
            <div
              id="syllabus-container-pre"
              class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start"
            ></div>

            <!-- Mains Header -->
            <div
              id="syl-header-mains"
              class="hidden items-center gap-3 mt-12 mb-4"
            >
              <span
                id="syl-text-mains"
                class="px-4 py-1.5 rounded-md bg-surfaceHighlight text-text font-bold border border-border shadow-sm tracking-wide uppercase text-sm"
                >Phase 2</span
              >
              <div
                class="h-px bg-border flex-1 shadow-[0_0_5px_var(--silver-glow)]"
              ></div>
            </div>
            <!-- FIXED: Added items-start to prevent adjacent card stretching -->
            <div
              id="syllabus-container-mains"
              class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start"
            ></div>
          </div>
        </div>
      </div>
    </template>

    <!-- FIREBASE MODULE -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getAuth,
        GoogleAuthProvider,
        signInWithPopup,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // --- FIREBASE CONFIG ---
      const firebaseConfig = {
        apiKey: "AIzaSyB3P5NBxglcK8wa4nfuZJHUfMqyt5LgFs4",
        authDomain: "syllabushub-d14e7.firebaseapp.com",
        projectId: "syllabushub-d14e7",
        storageBucket: "syllabushub-d14e7.firebasestorage.app",
        messagingSenderId: "688681727938",
        appId: "1:688681727938:web:d7f2d6645e0149e73bc85b",
        measurementId: "G-W4FZ1JCTKN",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const provider = new GoogleAuthProvider();

      // --- STATE ---
      let currentUser = null;
      let globalProgress = {}; // Stores all progress for all exams
      let unsubscribeDoc = null; // Function to stop listening to DB changes

      // --- AUTH FUNCTIONS ---
      window.handleLogin = async () => {
        try {
          await signInWithPopup(auth, provider);
        } catch (error) {
          console.error("Login Failed:", error);
          alert("Authentication failed. Check console.");
        }
      };

      window.handleLogout = async () => {
        try {
          await signOut(auth);
        } catch (error) {
          console.error("Logout Failed", error);
        }
      };

      // --- AUTH OBSERVER ---
      onAuthStateChanged(auth, (user) => {
        currentUser = user;
        const loginBtn = document.getElementById("login-btn");
        const profileDiv = document.getElementById("user-profile");
        const avatar = document.getElementById("user-avatar");
        const syncStatus = document.getElementById("sync-status");
        const warning = document.getElementById("auth-warning");

        if (user) {
          // UI: Logged In
          loginBtn.classList.add("hidden");
          profileDiv.classList.remove("hidden");
          avatar.src =
            user.photoURL || "https://img.icons8.com/color/48/user.png";
          syncStatus.innerHTML = `<i class="fa-solid fa-signal text-green-500"></i> Uplink Active`;
          if (warning) warning.classList.add("hidden");

          // DB: Start Listening
          const userRef = doc(db, "users", user.uid);
          unsubscribeDoc = onSnapshot(userRef, (docSnap) => {
            if (docSnap.exists()) {
              globalProgress = docSnap.data().progress || {};
            } else {
              globalProgress = {};
            }

            // --- FIX FOR COLLAPSING ACCORDIONS START ---
            // 1. Capture currently open accordions
            const openAccordions = [];
            document
              .querySelectorAll(".syllabus-content.open")
              .forEach((el) => {
                // Extract the full ID, e.g., 'content-syllabus-container-pre-0'
                openAccordions.push(el.id);
              });

            // 2. Refresh UI with new data
            if (window.currentExamId) window.loadExam(window.currentExamId);

            // 3. Restore previously open accordions
            openAccordions.forEach((contentId) => {
              const content = document.getElementById(contentId);
              // Derive icon ID (replace 'content-' with 'icon-')
              const iconId = contentId.replace("content-", "icon-");
              const icon = document.getElementById(iconId);

              if (content) {
                content.classList.add("open");
                // Set max-height directly to prevent animation lag on restore
                content.style.maxHeight = content.scrollHeight + "px";
              }
              if (icon) {
                icon.classList.add("open");
              }
            });
            // --- FIX END ---
          });
        } else {
          // UI: Logged Out
          loginBtn.classList.remove("hidden");
          profileDiv.classList.add("hidden");
          syncStatus.innerHTML = `<i class="fa-solid fa-ban text-red-500"></i> Offline Mode`;
          if (
            warning &&
            document.getElementById("view-syllabus") &&
            !document
              .getElementById("view-syllabus")
              .classList.contains("hidden")
          ) {
            warning.classList.remove("hidden");
          }

          // Cleanup Listener
          if (unsubscribeDoc) unsubscribeDoc();
          unsubscribeDoc = null;

          globalProgress = {};
          if (window.currentExamId) window.loadExam(window.currentExamId);
        }
      });

      // --- DB FUNCTIONS ---
      window.dbToggleTopic = async (examId, topicKey) => {
        if (!currentUser) {
          alert("Authentication required for cloud save.");
          return;
        }

        if (!globalProgress[examId]) globalProgress[examId] = {};
        const currentVal = globalProgress[examId][topicKey] || false;
        const newVal = !currentVal;

        const indicator = document.getElementById("save-indicator");
        if (indicator) {
          indicator.innerText = "UPLOADING...";
          indicator.style.opacity = "1";
        }

        try {
          const userRef = doc(db, "users", currentUser.uid);
          await setDoc(
            userRef,
            {
              progress: {
                [examId]: {
                  [topicKey]: newVal,
                },
              },
            },
            { merge: true }
          );

          if (indicator) {
            indicator.innerText = "SECURED";
            setTimeout(() => (indicator.style.opacity = "0"), 1500);
          }
        } catch (e) {
          console.error("Save failed:", e);
          if (indicator) indicator.innerText = "FAILED";
          alert("Uplink unstable. Save failed.");
        }
      };

      window.dbResetExam = async (examId) => {
        if (!currentUser) return;
        if (confirm("Reset all tactical data for this sector?")) {
          try {
            const userRef = doc(db, "users", currentUser.uid);
            await setDoc(
              userRef,
              {
                progress: {
                  [examId]: {},
                },
              },
              { merge: true }
            );
          } catch (e) {
            console.error(e);
          }
        }
      };

      document
        .getElementById("login-btn")
        .addEventListener("click", window.handleLogin);
      document
        .getElementById("logout-btn")
        .addEventListener("click", window.handleLogout);

      window.getGlobalProgress = () => globalProgress;
      window.isUserLoggedIn = () => !!currentUser;
    </script>

    <script>
      // --- LENIS SMOOTH SCROLL INITIALIZATION ---
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), // standard easeOutExpo
        direction: "vertical",
        gestureDirection: "vertical",
        smooth: true,
        mouseMultiplier: 1,
        smoothTouch: false,
        touchMultiplier: 2,
      });

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }
      requestAnimationFrame(raf);

      // --- SAFETIES ---
      if (!window.isUserLoggedIn) window.isUserLoggedIn = () => false;
      if (!window.getGlobalProgress) window.getGlobalProgress = () => ({});
      if (!window.dbToggleTopic)
        window.dbToggleTopic = () => console.warn("DB not ready");
      if (!window.dbResetExam)
        window.dbResetExam = () => console.warn("DB not ready");

      // --- CONFIG ---
      const examsList = [
        { id: "ossc-cgl", name: "OSSC CGL", icon: "fa-landmark", short: "CGL" },
        {
          id: "osssc-ri",
          name: "OSSSC RI, ARI",
          icon: "fa-ruler-combined",
          short: "RI/ARI",
        },
        {
          id: "odisha-si",
          name: "Odisha Police SI",
          icon: "fa-user-shield",
          short: "SI",
        },
        {
          id: "rrb-ntpc",
          name: "RRB NTPC",
          icon: "fa-train",
          short: "NTPC",
        },
        {
          id: "ssc-cgl",
          name: "SSC CGL",
          icon: "fa-building-columns",
          short: "SSC-CGL",
        },
        { id: "ssc-gd", name: "SSC GD", icon: "fa-person-rifle", short: "GD" },
      ];

      function getGradientClass(colorName) {
        // Wayne Tech Theme: Mostly variations of dark/gold/silver gradients or neutral
        const map = {
          blue: "from-blue-900 to-slate-800 border-blue-800",
          indigo: "from-indigo-900 to-slate-800 border-indigo-800",
          purple: "from-purple-900 to-slate-800 border-purple-800",
          red: "from-red-900 to-slate-800 border-red-800",
          emerald: "from-emerald-900 to-slate-800 border-emerald-800",
          orange: "from-orange-900 to-slate-800 border-orange-800",
          pink: "from-pink-900 to-slate-800 border-pink-800",
          teal: "from-teal-900 to-slate-800 border-teal-800",
        };
        const colorKey = colorName.split("-")[1];
        return map[colorKey] || "from-slate-800 to-gray-800 border-gray-700";
      }

      // --- SHARED SYLLABUS TOPICS (STRICTLY VERIFIED WITH ARCHIVE) ---
      const sharedTopics = {
        arithmetic: [
          "Percentage*",
          "Profit & Loss*",
          "Discount",
          "Simple Interest*",
          "Compound Interest*",
          "Ratio & Proportion*",
          "Partnership",
          "Mixture*",
          "Alligation",
          "Average*",
          "Time & Work*",
          "Pipe & Cistern*",
          "Time & Distance*",
          "Train",
          "Linear & Circular Race",
          "Boat & Stream*",
          "Permutation & Combination",
          "Probability",
          "Statistics",
          "Geometry: Lines & Angles",
          "Geometry: Triangle",
          "Geometry: Quadrilateral",
          "Geometry: Polygon",
          "Geometry: Circle",
          "Mensuration 2D",
          "Mensuration 3D",
          "Number System*",
          "LCM & HCF*",
          "Sequence & Series",
          "Simplification*",
          "Surds & Indices",
          "Algebra*",
          "Trigonometry",
          "Height & Distance",
          "Co-ordinate Geometry",
        ],
        reasoning: [
          "Classification*",
          "Analogy*",
          "Coding and Decoding*",
          "Blood Relation*",
          "Direction & Distance*",
          "Syllogism*",
          "Puzzles",
          "Seating Arrangement*",
          "Alphabet Series",
          "Number Series",
          "Alphanumeric Series",
          "Mixed Series",
          "Missing Number",
          "Alphabet Test",
          "Word Problem + Number Problems",
          "Ranking Test",
          "Mathematical Operation",
          "Logical Venn Diagram*",
          "Analytical Reasoning",
          "Inequality",
          "Data Sufficiency",
          "Calendar",
          "Clock",
          "NV: Cube and Dice*",
          "NV: Water Image and Mirror Image*",
          "NV: Paper Cutting and Folding*",
          "NV: Embedded Figure*",
          "NV: Figure Counting*",
        ],
        english: [
          "Grammatical Error*",
          "Nouns*",
          "Pronouns*",
          "Adjectives*",
          "Verbs*",
          "Adverbs",
          "Prepositions*",
          "Conjunctions*",
          "Subject-Verb Agreement*",
          "Tenses*",
          "Active and Passive Voice*",
          "Direct and Indirect Speech*",
          "Question Tags",
          "Fill in the Blanks",
          "Sentence Completion",
          "Sentence Improvement",
          "Cloze Test",
          "VOCAB: One Word Substitution*",
          "VOCAB: Idioms and Phrases*",
          "VOCAB: Synonyms & Antonyms*",
          "VOCAB: Spelling Test",
        ],
        odia: [
          "ଧ୍ଵନି, ବର୍ଣ୍ଣ, ମାତ୍ରା ଓ ଫଳା*",
          "ଶବ୍ଦ ବିଭାଗ*",
          "ବାକ୍ୟ ବିଭାଗ*",
          "ବିଶେଷ୍ୟ ଓ ସର୍ବନାମ*",
          "ବିଶେଷଣ*",
          "ଲିଙ୍ଗ, ପୁରୁଷ ଓ ବଚନ",
          "କାରକ*",
          "ବିଭକ୍ତି*",
          "ଅବ୍ୟୟ",
          "ଉପସର୍ଗ*",
          "କ୍ରିୟା*",
          "ସନ୍ଧି",
          "ସମାସ*",
          "କୃଦନ୍ତ",
          "ତଦ୍ଧିତ",
          "ଏକପଦୀକରଣ",
          "ବିପରୀତ-ଅର୍ଥ ବୋଧକଶବ୍ଦ*",
          "ପ୍ରତିଶବ୍ଦ*",
          "ରୂଢି*",
          "ଲୋକବାଣୀ",
          "ଅନୁଛେଦ*",
        ],
        computer: [
          "Computer Fundamentals",
          "History & Generations of Computer*",
          "Types of Computer",
          "I/O and Processing*",
          "Memory*",
          "Software & Types",
          "MS Windows*",
          "Windows Explorer*",
          "Operating System*",
          "Computer Architecture",
          "MS Word*",
          "MS Excel*",
          "MS PowerPoint*",
          "MS Access*",
          "Networking*",
          "Internet*",
          "Email*",
          "Cookies",
          "Computer Virus/Malware/Cybersecurity",
          "Printer and Types",
          "Computer Ports and Connectors",
          "DBMS and SQL",
          "Keyboard Shortcut Keys*",
          "Computer Abbreviations*",
        ],
        currentAffairs: [
          "Important National and International Events",
          "Important State Events",
          "Awards and Honours",
          "Books and Authors",
          "Important Scientific Inventions and Prizes",
          "Important Dates, Times and Themes",
          "Important Personalities and Obituaries",
          "Sports",
          "Report and Indices",
        ],
        generalScience: [
          "Force and Laws of Motion",
          "Sound",
          "Gravity",
          "Optics*",
          "Electricity",
          "Matter",
          "Atom and its Structure",
          "Periodic Table*",
          "Chemical Reactions",
          "Metals and Non-Metals*",
          "Acid, Base and Salt*",
          "Carbon and its Compounds",
          "Cell*",
          "Tissue",
          "Plant and Animal Kingdom*",
          "Nervous System*",
          "Hormones and Plant Movements",
          "Reproduction*",
          "Digestion*",
          "Respiration",
          "Circulatory System",
          "Excretory System",
          "Diseases*",
          "Nutrition*",
          "Hereditary and Evolution",
        ],
        staticGK: [
          "Classical Dances of India*",
          "Folk Dances of India",
          "Census 2011*",
          "Musical Instruments",
          "Gharanas",
          "Important Days",
          "Books and Authors*",
          "Sports",
          "International Organizations",
          "National Organizations*",
          "Festivals of India",
          "Government Schemes*",
          "Awards and Honours*",
        ],
        histIndia: [
          "Ancient: Stone Age",
          "Ancient: Indus Valley Civilization*",
          "Ancient: Vedic Age*",
          "Ancient: Jainism and Buddhism*",
          "Ancient: Mahajanpadas",
          "Ancient: Maurya Dynasty*",
          "Ancient: Post-Maurya Dynasties",
          "Ancient: Gupta Dynasty*",
          "Ancient: Post-Gupta Dynasties",
          "Ancient: Sangam Age",
          "Ancient: Tripartite Struggle and Cholas*",
          "Medieval: Delhi Sultanate*",
          "Medieval: Vijayanagara and Bahmani Kingdom",
          "Medieval: Mughal Empire*",
          "Medieval: Marathas",
          "Medieval: Bhakti and Sufi Movements*",
          "Modern: Advent of Europeans*",
          "Modern: Socio-Religious Reforms*",
          "Modern: Revolt of 1857*",
          "Modern: Indian National Congress*",
          "Modern: Bengal Partition*",
          "Modern: Gandhian Era*",
          "Modern: CDM and Simon Commission*",
          "Modern: Quit India Movement*",
          "Modern: Governor-General and Viceroy*",
        ],
        geoIndia: [
          "Solar System",
          "Longitude and Latitude",
          "Earth's Interior and Plate Tectonics",
          "Rocks Continents and Ocean",
          "Geomorphology and Landforms",
          "Atmosphere",
          "Wind, Ocean Current and Cyclone",
          "India and Its Location",
          "Himalayas",
          "Peninsular Plateaus",
          "Northern Plain and Islands",
          "Himalayan River System",
          "Peninsular Rivers",
          "Dams, Lakes and Waterfall",
          "Monsoon",
          "Forest and Grassland",
          "Soil and Agriculture",
          "Minerals",
          "World Map",
          "National Parks",
        ],
        polity: [
          "Sources of Constitution",
          "Making of Constitution",
          "Salient Features of Constitution",
          "Preamble, Part I & Part II",
          "Fundamental Rights",
          "DPSPs & Fundamental Duties",
          "President & Vice President",
          "Prime Minister & Council of Ministers",
          "Parliament",
          "State",
          "Emergency & Constitutional Amendments",
          "Supreme Court & High Court",
          "Local Government",
          "Constitutional & Non Constitutional Bodies",
          "Important Acts",
        ],
        economy: [
          "Basics of Economy",
          "Demand and Supply",
          "National Income",
          "Inflation and Unemployment",
          "Budget and Taxation",
          "Monetary Policy",
          "Money and Banking",
          "Balance of Payment and Poverty",
          "Five Year Plans and Industrial Policy Resolution",
        ],
        odishaHistory: [
          "The Reign of Mauryas",
          "Under the rule of Chedi Dynasty",
          "The rule of Guptas",
          "Other Dynasties",
          "The Imperial Gangas",
          "The Suryavamsi Gajapatis",
          "Khorda's Bhoi Dynasty",
          "Muslim Conquest of Odisha",
          "Odisha Under the Mughals",
          "Odisha Under the Marathas",
          "British Occupation of Odisha",
          "Khurda Rising of 1804 and Paika Rebellion of 1817",
          "Odisha During the Revolt of 1857",
          "Tribal Uprising in Odisha",
          "Odisha Timeline - Early 19th Century",
          "Freedom Struggle of Odisha",
          "Movements for Separate Province",
          "Prajamandal Movement and Merger of the States",
        ],
        odishaGeo: [
          "Location & Coastline",
          "Physiographic Divisions",
          "River System",
          "Dams, Lakes & Waterfalls",
          "Climate and Natural Calamities",
          "Forest Resources and Wildlife",
          "Demography (Census)",
          "Industry and Mineral",
          "Soil",
          "Misc MCQs",
        ],
        odishaEco: [
          "Odisha Economy - Intro and its Economy before 1947",
          "Macroeconomy of Odisha",
          "Odisha State Public Finances",
          "Agriculture Development in Odisha",
          "Industrial Development in Odisha",
          "Tertiary Sector Development in Odisha",
          "Social Sector Development in Odisha",
          "Human Development and Poverty in Odisha",
          "Budget and Economic Surveys",
        ],
        odishaStatic: [
          "Folk Art, Crafts & Culture",
          "Temples",
          "Famous Places",
          "Dance & Music",
          "Fair & Festivals",
          "Cuisin of Odisha",
          "Tribes of Odisha",
          "Monuments",
          "Language & Literature",
          "Awards & Honours",
          "Books & Authors",
        ],
      };

      // --- CONTENT DATA ---
      window.contentData = {
        // --- OSSC CGL ---
        "ossc-cgl": {
          hasSeparateSections: true,
          pattern: `
                     <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-blue-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Preliminary Examination (CBRE Mode)</h3>
                                <p class="text-blue-100 text-xs mt-1 font-medium">150 Minutes | 0.25 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">150 Marks</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">Arithmetic (10th Standard)</td></tr>
                                    <tr><td class="px-8 py-3.5">Data Interpretation (Chart, Graph, Table, Data Sufficiency)</td></tr>
                                    <tr><td class="px-8 py-3.5">Logical Reasoning & Analytical Ability, General Mental Ability</td></tr>
                                    <tr><td class="px-8 py-3.5">Current Events of National & International Importance</td></tr>
                                    <tr><td class="px-8 py-3.5">Computer / Internet Awareness</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                         <div class="bg-gradient-to-r from-indigo-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Main Written Examination</h3>
                                <p class="text-indigo-100 text-xs mt-1 font-medium">0.25 Negative Marking (Objective)</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">200 Marks</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Paper</th><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-center">Duration</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-4 font-bold text-text">Paper I</td><td class="px-8 py-4">Language (Odia & English)</td><td class="px-8 py-4 text-center">2.5 Hrs</td><td class="px-8 py-4 text-right font-bold text-text">100</td></tr>
                                    <tr><td class="px-8 py-4 font-bold text-text">Paper II</td><td class="px-8 py-4">General Studies (Const, Eco, Geo, Hist, Env)</td><td class="px-8 py-4 text-center">2.5 Hrs</td><td class="px-8 py-4 text-right font-bold text-text">100</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                     <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect">
                        <div class="bg-surfaceHighlight px-8 py-4 border-b border-white/5">
                            <h3 class="font-bold text-text text-sm uppercase tracking-wider">Skill Test (Qualifying)</h3>
                        </div>
                        <div class="p-6 text-sm text-textMuted">
                            <ul class="list-disc pl-5 space-y-2">
                                <li><strong>Mathematics Test:</strong> For Auditor posts.</li>
                                <li><strong>Computer Skill Test:</strong> For posts requiring computer proficiency.</li>
                            </ul>
                        </div>
                    </div>
                `,
          syllabusPre: [
            {
              title: "Arithmetic",
              icon: "fa-calculator",
              color: "text-blue-500",
              topics: sharedTopics.arithmetic,
            },
            {
              title: "Data Interpretation",
              icon: "fa-chart-pie",
              color: "text-indigo-500",
              topics: [
                "Tabular DI",
                "Bar Graph",
                "Line Graph",
                "Pie Chart",
                "Histogram",
                "Mixed DI",
                "Missing DI",
              ],
            },
            {
              title: "Reasoning",
              icon: "fa-brain",
              color: "text-purple-500",
              topics: sharedTopics.reasoning,
            },
            {
              title: "Current Affairs",
              icon: "fa-newspaper",
              color: "text-red-500",
              topics: sharedTopics.currentAffairs,
            },
            {
              title: "Computer",
              icon: "fa-laptop-code",
              color: "text-emerald-500",
              topics: sharedTopics.computer,
            },
            {
              title: "Odisha GK: History",
              icon: "fa-monument",
              color: "text-orange-500",
              topics: sharedTopics.odishaHistory,
            },
            {
              title: "Odisha GK: Geography",
              icon: "fa-map",
              color: "text-teal-500",
              topics: sharedTopics.odishaGeo,
            },
            {
              title: "Odisha GK: Economics",
              icon: "fa-sack-dollar",
              color: "text-pink-500",
              topics: sharedTopics.odishaEco,
            },
            {
              title: "Odisha GK: Static",
              icon: "fa-masks-theater",
              color: "text-orange-500",
              topics: sharedTopics.odishaStatic,
            },
          ],
          syllabusMains: [
            {
              title: "Paper I: English",
              icon: "fa-book-open",
              color: "text-blue-500",
              topics: sharedTopics.english,
            },
            {
              title: "Paper I: Odia",
              icon: "fa-language",
              color: "text-red-500",
              topics: sharedTopics.odia,
            },
            {
              title: "Paper II: Indian Polity",
              icon: "fa-scale-balanced",
              color: "text-indigo-500",
              topics: sharedTopics.polity,
            },
            {
              title: "Paper II: Indian Economics",
              icon: "fa-coins",
              color: "text-emerald-500",
              topics: sharedTopics.economy,
            },
            {
              title: "Paper II: Geography",
              icon: "fa-earth-americas",
              color: "text-teal-500",
              topics: sharedTopics.geoIndia,
            },
            {
              title: "Paper II: History",
              icon: "fa-landmark-dome",
              color: "text-orange-500",
              topics: sharedTopics.histIndia,
            },
            {
              title: "Paper II: Env & Climate",
              icon: "fa-leaf",
              color: "text-green-500",
              topics: [
                "Basics of Environmental Science",
                "Ecosystem",
                "Trophic Dynamics and Energy Transfer",
                "Biogeochemical Cycles",
                "Environmental Conventions",
                "Recent Climate Changes",
              ],
            },
          ],
        },

        // --- OSSSC RI ---
        "osssc-ri": {
          hasSeparateSections: false,
          pattern: `
                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-teal-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Preliminary Examination (CBRT Mode)</h3>
                                <p class="text-teal-100 text-xs mt-1 font-medium">90 Minutes | 0.33 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">100 Marks</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-right">Questions</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">Mathematics</td><td class="px-8 py-3.5 text-right text-text">20</td></tr>
                                    <tr><td class="px-8 py-3.5">General Studies</td><td class="px-8 py-3.5 text-right text-text">20</td></tr>
                                    <tr><td class="px-8 py-3.5">English</td><td class="px-8 py-3.5 text-right text-text">20</td></tr>
                                    <tr><td class="px-8 py-3.5">Odia</td><td class="px-8 py-3.5 text-right text-text">20</td></tr>
                                    <tr><td class="px-8 py-3.5">Logical Reasoning</td><td class="px-8 py-3.5 text-right text-text">20</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-purple-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Main Examination (CBRT Mode)</h3>
                                <p class="text-purple-100 text-xs mt-1 font-medium">3 Hours | 0.33 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">180 Marks</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-right">Questions/Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">Mathematics</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">General Studies</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">English</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">Odia</td><td class="px-8 py-3.5 text-right text-text">20</td></tr>
                                    <tr><td class="px-8 py-3.5">Computer</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect">
                        <div class="bg-surfaceHighlight px-8 py-4 border-b border-white/5">
                            <h3 class="font-bold text-text text-sm uppercase tracking-wider">Skill Test (Qualifying)</h3>
                        </div>
                        <div class="p-6 text-sm text-textMuted">
                            <p><strong>Practical Skill Test in Basic Computer Skills</strong></p>
                            <ul class="list-disc pl-5 mt-2 space-y-1">
                                <li>Total Marks: 50</li>
                                <li>Duration: 1 Hour</li>
                                <li>Nature: Qualifying (Min 40% required)</li>
                            </ul>
                        </div>
                    </div>
                `,
          syllabusPre: [
            {
              title: "Arithmetic",
              icon: "fa-calculator",
              color: "text-blue-500",
              topics: sharedTopics.arithmetic,
            },
            {
              title: "Reasoning",
              icon: "fa-brain",
              color: "text-purple-500",
              topics: sharedTopics.reasoning,
            },
            {
              title: "English",
              icon: "fa-book-open",
              color: "text-teal-500",
              topics: sharedTopics.english,
            },
            {
              title: "Odia",
              icon: "fa-language",
              color: "text-red-500",
              topics: sharedTopics.odia,
            },
            {
              title: "Computer",
              icon: "fa-laptop-code",
              color: "text-indigo-500",
              topics: sharedTopics.computer,
            },
            {
              title: "GS: General Science",
              icon: "fa-flask",
              color: "text-green-500",
              topics: sharedTopics.generalScience,
            },
            {
              title: "GS: Indian History",
              icon: "fa-landmark-dome",
              color: "text-orange-500",
              topics: sharedTopics.histIndia,
            },
            {
              title: "GS: Indian Geography",
              icon: "fa-earth-americas",
              color: "text-teal-500",
              topics: sharedTopics.geoIndia,
            },
            {
              title: "GS: Indian Polity",
              icon: "fa-scale-balanced",
              color: "text-indigo-500",
              topics: sharedTopics.polity,
            },
            {
              title: "GS: Indian Economy",
              icon: "fa-coins",
              color: "text-emerald-500",
              topics: sharedTopics.economy,
            },
            {
              title: "GS: Indian Static GK",
              icon: "fa-masks-theater",
              color: "text-pink-500",
              topics: sharedTopics.staticGK,
            },
            {
              title: "GS: Current Affairs",
              icon: "fa-newspaper",
              color: "text-red-500",
              topics: sharedTopics.currentAffairs,
            },
            {
              title: "Odisha GK: History",
              icon: "fa-monument",
              color: "text-orange-500",
              topics: sharedTopics.odishaHistory,
            },
            {
              title: "Odisha GK: Geography",
              icon: "fa-map",
              color: "text-teal-500",
              topics: sharedTopics.odishaGeo,
            },
            {
              title: "Odisha GK: Economics",
              icon: "fa-sack-dollar",
              color: "text-pink-500",
              topics: sharedTopics.odishaEco,
            },
            {
              title: "Odisha GK: Static",
              icon: "fa-masks-theater",
              color: "text-orange-500",
              topics: sharedTopics.odishaStatic,
            },
          ],
          syllabusMains: [],
        },

        // --- ODISHA SI ---
        "odisha-si": {
          hasSeparateSections: true,
          pattern: `
                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-blue-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Paper I: Language (CBRE)</h3>
                                <p class="text-blue-100 text-xs mt-1 font-medium">90 Minutes | 0.25 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">100 Marks</span>
                        </div>
                         <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">General English</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                    <tr><td class="px-8 py-3.5">Odia Language</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-indigo-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Paper II: General Studies (CBRE)</h3>
                                <p class="text-indigo-100 text-xs mt-1 font-medium">180 Minutes (3 Hrs) | 0.25 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">200 Marks</span>
                        </div>
                         <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">General Studies</td><td class="px-8 py-3.5 text-right text-text">200</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `,
          syllabusPre: [
            {
              title: "English Language",
              icon: "fa-book-open",
              color: "text-blue-500",
              topics: sharedTopics.english,
            },
            {
              title: "Odia Language",
              icon: "fa-language",
              color: "text-red-500",
              topics: sharedTopics.odia,
            },
          ],
          syllabusMains: [
            {
              title: "Maths (Arithmetic)",
              icon: "fa-calculator",
              color: "text-blue-500",
              topics: sharedTopics.arithmetic,
            },
            {
              title: "Reasoning",
              icon: "fa-brain",
              color: "text-purple-500",
              topics: sharedTopics.reasoning,
            },
            {
              title: "Computer",
              icon: "fa-laptop-code",
              color: "text-indigo-500",
              topics: sharedTopics.computer,
            },
            {
              title: "GS: Indian History",
              icon: "fa-landmark-dome",
              color: "text-orange-500",
              topics: sharedTopics.histIndia,
            },
            {
              title: "GS: Indian Geography",
              icon: "fa-earth-americas",
              color: "text-teal-500",
              topics: sharedTopics.geoIndia,
            },
            {
              title: "GS: Indian Polity",
              icon: "fa-scale-balanced",
              color: "text-indigo-500",
              topics: sharedTopics.polity,
            },
            {
              title: "GS: Indian Economy",
              icon: "fa-coins",
              color: "text-emerald-500",
              topics: sharedTopics.economy,
            },
            {
              title: "GS: General Science",
              icon: "fa-flask",
              color: "text-green-500",
              topics: sharedTopics.generalScience,
            },
            {
              title: "GS: Static GK",
              icon: "fa-masks-theater",
              color: "text-pink-500",
              topics: sharedTopics.staticGK,
            },
            {
              title: "GS: Current Affairs",
              icon: "fa-newspaper",
              color: "text-red-500",
              topics: sharedTopics.currentAffairs,
            },
            {
              title: "Odisha GK: History",
              icon: "fa-monument",
              color: "text-orange-500",
              topics: sharedTopics.odishaHistory,
            },
            {
              title: "Odisha GK: Geography",
              icon: "fa-map",
              color: "text-teal-500",
              topics: sharedTopics.odishaGeo,
            },
            {
              title: "Odisha GK: Economics",
              icon: "fa-sack-dollar",
              color: "text-pink-500",
              topics: sharedTopics.odishaEco,
            },
            {
              title: "Odisha GK: Static",
              icon: "fa-masks-theater",
              color: "text-orange-500",
              topics: sharedTopics.odishaStatic,
            },
          ],
        },
        // --- RRB NTPC ---
        "rrb-ntpc": {
          hasSeparateSections: false,
          pattern: `
                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-red-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">CBT 1</h3>
                                <p class="text-red-100 text-xs mt-1 font-medium">90 Minutes | 1/3 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">100 Marks</span>
                        </div>
                         <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">General Awareness</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">Mathematics</td><td class="px-8 py-3.5 text-right text-text">30</td></tr>
                                    <tr><td class="px-8 py-3.5">General Intelligence & Reasoning</td><td class="px-8 py-3.5 text-right text-text">30</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-orange-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">CBT 2</h3>
                                <p class="text-orange-100 text-xs mt-1 font-medium">90 Minutes | 1/3 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">120 Marks</span>
                        </div>
                         <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">General Awareness</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                    <tr><td class="px-8 py-3.5">Mathematics</td><td class="px-8 py-3.5 text-right text-text">35</td></tr>
                                    <tr><td class="px-8 py-3.5">General Intelligence & Reasoning</td><td class="px-8 py-3.5 text-right text-text">35</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
           `,
          syllabusPre: [
            {
              title: "Mathematics",
              icon: "fa-calculator",
              color: "text-blue-500",
              topics: sharedTopics.arithmetic,
            },
            {
              title: "Reasoning",
              icon: "fa-brain",
              color: "text-purple-500",
              topics: sharedTopics.reasoning,
            },
            {
              title: "GA: History",
              icon: "fa-landmark-dome",
              color: "text-orange-500",
              topics: sharedTopics.histIndia,
            },
            {
              title: "GA: Geography",
              icon: "fa-earth-americas",
              color: "text-teal-500",
              topics: sharedTopics.geoIndia,
            },
            {
              title: "GA: Polity",
              icon: "fa-scale-balanced",
              color: "text-indigo-500",
              topics: sharedTopics.polity,
            },
            {
              title: "GA: Economy",
              icon: "fa-coins",
              color: "text-emerald-500",
              topics: sharedTopics.economy,
            },
            {
              title: "GA: General Science",
              icon: "fa-flask",
              color: "text-green-500",
              topics: sharedTopics.generalScience,
            },
            {
              title: "GA: Static GK",
              icon: "fa-masks-theater",
              color: "text-pink-500",
              topics: sharedTopics.staticGK,
            },
            {
              title: "GA: Current Affairs",
              icon: "fa-newspaper",
              color: "text-red-500",
              topics: sharedTopics.currentAffairs,
            },
          ],
          syllabusMains: [],
        },
        // --- SSC CGL ---
        "ssc-cgl": {
          hasSeparateSections: false,
          pattern: `
                     <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-gray-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Tier-I (Qualifying)</h3>
                                <p class="text-gray-100 text-xs mt-1 font-medium">60 Minutes | 0.50 Negative Marking</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">200 Marks</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-center">Qs</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">General Intelligence & Reasoning</td><td class="px-8 py-3.5 text-center text-text">25</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                    <tr><td class="px-8 py-3.5">General Awareness</td><td class="px-8 py-3.5 text-center text-text">25</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                    <tr><td class="px-8 py-3.5">Quantitative Aptitude</td><td class="px-8 py-3.5 text-center text-text">25</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                    <tr><td class="px-8 py-3.5">English Comprehension</td><td class="px-8 py-3.5 text-center text-text">25</td><td class="px-8 py-3.5 text-right text-text">50</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-slate-900 to-black px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">Tier-II (Paper I)</h3>
                                <p class="text-gray-100 text-xs mt-1 font-medium">2 Hrs 15 Mins | 1 Mark Negative</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">Compulsory</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border">
                                    <tr><th class="px-6 py-4">Section</th><th class="px-6 py-4">Module</th><th class="px-6 py-4 text-right">Qs x 3 = Marks</th></tr>
                                </thead>
                                <tbody class="divide-y divide-border">
                                    <tr class="bg-surfaceHighlight/10"><td class="px-6 py-3 font-bold" rowspan="2">Section I<br><span class="text-xs font-normal opacity-70">1 Hour</span></td><td class="px-6 py-3">Math Abilities</td><td class="px-6 py-3 text-right">30 x 3 = 90</td></tr>
                                    <tr class="bg-surfaceHighlight/10"><td class="px-6 py-3">Reasoning & Gen Int.</td><td class="px-6 py-3 text-right">30 x 3 = 90</td></tr>
                                    
                                    <tr><td class="px-6 py-3 font-bold" rowspan="2">Section II<br><span class="text-xs font-normal opacity-70">1 Hour</span></td><td class="px-6 py-3">English Lang & Comp</td><td class="px-6 py-3 text-right">45 x 3 = 135</td></tr>
                                    <tr><td class="px-6 py-3">General Awareness</td><td class="px-6 py-3 text-right">25 x 3 = 75</td></tr>

                                    <tr class="bg-surfaceHighlight/10"><td class="px-6 py-3 font-bold" rowspan="2">Section III<br><span class="text-xs font-normal opacity-70">Qualifying</span></td><td class="px-6 py-3">Computer Knowledge (15m)</td><td class="px-6 py-3 text-right">20 x 3 = 60</td></tr>
                                    <tr class="bg-surfaceHighlight/10"><td class="px-6 py-3">DEST (15m)</td><td class="px-6 py-3 text-right">Data Entry</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
            `,
          syllabusPre: [
            {
              title: "Quantitative Aptitude",
              icon: "fa-calculator",
              color: "text-blue-500",
              topics: sharedTopics.arithmetic,
            },
            {
              title: "Reasoning",
              icon: "fa-brain",
              color: "text-purple-500",
              topics: sharedTopics.reasoning,
            },
            {
              title: "English",
              icon: "fa-book-open",
              color: "text-teal-500",
              topics: sharedTopics.english,
            },
            {
              title: "Computer Module",
              icon: "fa-laptop-code",
              color: "text-indigo-500",
              topics: sharedTopics.computer,
            },
            {
              title: "GA: History",
              icon: "fa-landmark-dome",
              color: "text-orange-500",
              topics: sharedTopics.histIndia,
            },
            {
              title: "GA: Geography",
              icon: "fa-earth-americas",
              color: "text-teal-500",
              topics: sharedTopics.geoIndia,
            },
            {
              title: "GA: Polity",
              icon: "fa-scale-balanced",
              color: "text-indigo-500",
              topics: sharedTopics.polity,
            },
            {
              title: "GA: Economy",
              icon: "fa-coins",
              color: "text-emerald-500",
              topics: sharedTopics.economy,
            },
            {
              title: "GA: Science",
              icon: "fa-flask",
              color: "text-green-500",
              topics: sharedTopics.generalScience,
            },
            {
              title: "GA: Static",
              icon: "fa-masks-theater",
              color: "text-pink-500",
              topics: sharedTopics.staticGK,
            },
            {
              title: "GA: Current Affairs",
              icon: "fa-newspaper",
              color: "text-red-500",
              topics: sharedTopics.currentAffairs,
            },
          ],
          syllabusMains: [],
        },
        // --- SSC GD ---
        "ssc-gd": {
          hasSeparateSections: false,
          pattern: `
                     <div class="glass-panel rounded-2xl overflow-hidden hover-card-effect mb-6">
                        <div class="bg-gradient-to-r from-emerald-900 to-slate-800 px-8 py-5 flex justify-between items-center card-gradient-header border-b border-white/5">
                            <div class="text-white">
                                <h3 class="font-bold text-lg">CBE (Revised 2025 Pattern)</h3>
                                <p class="text-emerald-100 text-xs mt-1 font-medium">60 Minutes | 0.25 Marks Negative</p>
                            </div>
                            <span class="bg-primary/20 backdrop-blur-md text-primary text-xs px-3 py-1.5 rounded-lg font-bold border border-primary/30 shadow-sm">160 Marks</span>
                        </div>
                        <div class="p-0 overflow-x-auto">
                             <table class="w-full text-sm text-left text-textMuted">
                                <thead class="text-xs uppercase bg-surfaceHighlight text-text border-b border-border"><tr><th class="px-8 py-4">Part</th><th class="px-8 py-4 text-center">Qs</th><th class="px-8 py-4 text-right">Marks</th></tr></thead>
                                <tbody class="divide-y divide-border">
                                    <tr><td class="px-8 py-3.5">Part A: Gen Intelligence & Reasoning</td><td class="px-8 py-3.5 text-center text-text">20</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">Part B: GK & General Awareness</td><td class="px-8 py-3.5 text-center text-text">20</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">Part C: Elementary Mathematics</td><td class="px-8 py-3.5 text-center text-text">20</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                    <tr><td class="px-8 py-3.5">Part D: English / Hindi</td><td class="px-8 py-3.5 text-center text-text">20</td><td class="px-8 py-3.5 text-right text-text">40</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
            `,
          syllabusPre: [
            {
              title: "Elementary Math",
              icon: "fa-calculator",
              color: "text-blue-500",
              topics: sharedTopics.arithmetic,
            },
            {
              title: "Reasoning",
              icon: "fa-brain",
              color: "text-purple-500",
              topics: sharedTopics.reasoning,
            },
            {
              title: "English",
              icon: "fa-book-open",
              color: "text-teal-500",
              topics: sharedTopics.english,
            },
            {
              title: "GK: History",
              icon: "fa-landmark-dome",
              color: "text-orange-500",
              topics: sharedTopics.histIndia,
            },
            {
              title: "GK: Geography",
              icon: "fa-earth-americas",
              color: "text-teal-500",
              topics: sharedTopics.geoIndia,
            },
            {
              title: "GK: Polity",
              icon: "fa-scale-balanced",
              color: "text-indigo-500",
              topics: sharedTopics.polity,
            },
            {
              title: "GK: Economy",
              icon: "fa-coins",
              color: "text-emerald-500",
              topics: sharedTopics.economy,
            },
            {
              title: "GK: Science",
              icon: "fa-flask",
              color: "text-green-500",
              topics: sharedTopics.generalScience,
            },
            {
              title: "GK: Static",
              icon: "fa-masks-theater",
              color: "text-pink-500",
              topics: sharedTopics.staticGK,
            },
            {
              title: "GK: Current Affairs",
              icon: "fa-newspaper",
              color: "text-red-500",
              topics: sharedTopics.currentAffairs,
            },
          ],
          syllabusMains: [],
        },
      };

      // --- MAIN APP LOGIC ---
      window.currentExamId = "ossc-cgl";
      let currentView = "pattern";

      function init() {
        initTheme();
        renderExamList();
        loadExam(currentExamId);
      }

      const themes = ["dark", "light"];
      let currentThemeIndex = 0; // Default to Dark (Wayne Tech)

      function initTheme() {
        const savedTheme = localStorage.getItem("sh_theme");
        if (savedTheme) {
          applyTheme(savedTheme);
          currentThemeIndex = themes.indexOf(savedTheme);
        } else {
          applyTheme("dark");
        }
      }
      function toggleTheme() {
        currentThemeIndex = (currentThemeIndex + 1) % themes.length;
        const newTheme = themes[currentThemeIndex];
        applyTheme(newTheme);
        localStorage.setItem("sh_theme", newTheme);
      }
      function applyTheme(themeName) {
        document.documentElement.setAttribute("data-theme", themeName);
        const icon = document.getElementById("theme-icon");
        if (themeName === "light") {
          icon.className =
            "fa-solid fa-sun text-orange-500 text-lg transition-transform duration-500 rotate-180";
        } else {
          icon.className =
            "fa-solid fa-moon text-blue-400 text-lg transition-transform duration-500 rotate-0";
        }
      }

      function renderExamList() {
        const list = document.getElementById("exam-list");
        list.innerHTML = "";

        examsList.forEach((exam) => {
          const btn = document.createElement("button");
          // Wayne Tech Exam Pill Style
          btn.className = `exam-pill group min-w-max flex items-center gap-2.5 px-5 py-2.5 rounded-xl border border-border text-textMuted hover:text-text transition-all snap-start ${
            exam.id === currentExamId ? "active" : ""
          }`;
          btn.dataset.id = exam.id;
          btn.innerHTML = `
                    <i class="fa-solid ${exam.icon} text-sm"></i>
                    <span class="font-semibold text-sm tracking-wide uppercase">${exam.name}</span>
                `;
          btn.addEventListener("click", () => window.loadExam(exam.id));
          list.appendChild(btn);
        });
      }

      window.updateProgressUI = function (percent) {
        const txt = document.getElementById("progress-text");
        const bar = document.getElementById("progress-bar");
        if (txt) txt.innerText = `${percent}%`;
        if (bar) bar.style.width = `${percent}%`;
      };

      window.loadExam = function (id) {
        if (id !== window.currentExamId) {
          currentView = "pattern";
        }

        window.currentExamId = id;

        document.querySelectorAll(".exam-pill").forEach((btn) => {
          if (btn.dataset.id === id) {
            btn.classList.add("active");
            btn.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
              inline: "center",
            });
          } else {
            btn.classList.remove("active");
          }
        });

        const examObj = examsList.find((e) => e.id === id);
        document.getElementById(
          "current-exam-label"
        ).innerText = `${examObj.short} STATUS`;

        const container = document.getElementById("content-area");
        const data = contentData[id];

        container.innerHTML = "";

        if (!data) {
          const tmpl = document
            .getElementById("tmpl-empty")
            .content.cloneNode(true);
          tmpl.getElementById("empty-exam-name").innerText = examObj.name;
          container.appendChild(tmpl);
          window.updateProgressUI(0);
        } else {
          const tmpl = document
            .getElementById("tmpl-dashboard")
            .content.cloneNode(true);
          container.appendChild(tmpl);

          const warning = document.getElementById("auth-warning");
          if (!window.isUserLoggedIn() && warning) {
            warning.classList.remove("hidden");
          } else if (warning) {
            warning.classList.add("hidden");
          }

          document.getElementById("pattern-container").innerHTML = data.pattern;

          const preHeader = document.getElementById("syl-header-pre");
          const mainsHeader = document.getElementById("syl-header-mains");

          let preText = "Phase 1 Syllabus";
          let mainsText = "Phase 2 Syllabus";

          if (id === "ssc-cgl" || id === "rrb-ntpc" || id === "osssc-ri") {
            preText = "Combined Syllabus Protocol";
            mainsText = "";
          } else if (id === "ssc-gd") {
            preText = "CBE Syllabus";
            mainsText = "";
          }

          if (document.getElementById("syl-text-pre"))
            document.getElementById("syl-text-pre").innerText = preText;
          if (document.getElementById("syl-text-mains"))
            document.getElementById("syl-text-mains").innerText = mainsText;

          if (data.hasSeparateSections) {
            preHeader.style.display = "flex";
            mainsHeader.style.display = "flex";
            window.loadSyllabusSection(
              "syllabus-container-pre",
              data.syllabusPre
            );
            window.loadSyllabusSection(
              "syllabus-container-mains",
              data.syllabusMains
            );
          } else {
            preHeader.style.display = "flex";
            mainsHeader.style.display = "none";
            window.loadSyllabusSection(
              "syllabus-container-pre",
              data.syllabusPre
            );
            document.getElementById("syllabus-container-mains").style.display =
              "none";
          }

          window.updateTotalProgress(
            data.syllabusPre.concat(data.syllabusMains)
          );
          window.switchView(currentView);
        }
      };

      // --- NEW COLLAPSIBLE CARD GENERATION ---
      window.loadSyllabusSection = function (containerId, syllabusArray) {
        const sylContainer = document.getElementById(containerId);
        sylContainer.innerHTML = "";

        if (!syllabusArray || syllabusArray.length === 0) return;

        const allProgress = window.getGlobalProgress
          ? window.getGlobalProgress()
          : {};
        const examProgress = allProgress[window.currentExamId] || {};

        syllabusArray.forEach((cat, index) => {
          const uniqueId = `${containerId}-${index}`;
          const catTopicsTotal = cat.topics.length;
          let catTopicsDone = 0;
          const gradientClass = getGradientClass(cat.color);

          cat.topics.forEach((t) => {
            if (examProgress[t]) catTopicsDone++;
          });

          // Generate Topic HTML
          let topicHTML = "";
          if (cat.topics.length === 0) {
            topicHTML = `<div class="p-4 text-center border border-dashed border-border rounded-xl bg-surfaceHighlight/30"><span class="text-sm text-textMuted font-medium">No Intel Available</span></div>`;
          } else {
            topicHTML = cat.topics
              .map((topic) => {
                const isChecked = examProgress[topic] === true;
                const isOdia = /[\u0B00-\u0B7F]/.test(topic);
                const fontClass = isOdia
                  ? "odia-text text-lg leading-relaxed"
                  : "text-sm leading-relaxed";
                const safeTopic = topic.replace(/'/g, "\\'");
                const safeCat = cat.title.replace(/'/g, "\\'");

                return `
                    <div class="topic-card cursor-pointer p-3 rounded-xl bg-surface/50 flex items-center gap-3 ${
                      isChecked ? "completed" : ""
                    }" 
                         onclick="window.toggleTopic('${safeCat}', '${safeTopic}')">
                        <label class="custom-checkbox relative flex-shrink-0 flex items-center justify-center w-5 h-5 cursor-pointer">
                            <input type="checkbox" class="absolute opacity-0 w-0 h-0" ${
                              isChecked ? "checked" : ""
                            }>
                            <div class="w-5 h-5 bg-surfaceHighlight border border-border rounded transition-all duration-300 flex items-center justify-center shadow-sm">
                                <i class="fa-solid fa-check text-black text-[10px] font-bold"></i>
                            </div>
                        </label>
                        <span class="topic-text font-medium text-text select-none flex-1 ${fontClass}">${topic}</span>
                    </div>
                `;
              })
              .join("");
            topicHTML = `<div class="grid gap-2 pt-2">${topicHTML}</div>`;
          }

          // Generate Collapsible Card
          const card = document.createElement("div");
          // FIX: Added 'h-fit' to prevent flex/grid stretching
          card.className =
            "glass-panel rounded-2xl overflow-hidden hover-card-effect transition-all h-fit";

          card.innerHTML = `
            <div class="cursor-pointer" onclick="window.toggleAccordion('${uniqueId}')">
                <div class="px-6 py-4 border-b border-white/5 flex items-center justify-between bg-gradient-to-r ${gradientClass} card-gradient-header">
                    <div class="flex items-center gap-3 text-white">
                        <div class="w-8 h-8 rounded-lg bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/10 shadow-sm">
                            <i class="fa-solid ${cat.icon} text-sm"></i>
                        </div>
                        <h4 class="font-bold text-lg tracking-wide shadow-black drop-shadow-sm">${
                          cat.title
                        }</h4>
                    </div>
                    <div class="flex items-center gap-3">
                        ${
                          catTopicsTotal > 0
                            ? `<span class="text-xs font-bold text-white bg-black/30 backdrop-blur-md px-2.5 py-1 rounded-md border border-white/10 shadow-sm font-mono">${catTopicsDone}/${catTopicsTotal}</span>`
                            : ""
                        }
                        <i id="icon-${uniqueId}" class="fa-solid fa-chevron-down text-white/70 rotate-icon transition-transform"></i>
                    </div>
                </div>
            </div>
            
            <div id="content-${uniqueId}" class="syllabus-content bg-surface/30">
                <div class="p-5">
                    ${topicHTML}
                </div>
            </div>
          `;
          sylContainer.appendChild(card);
        });
      };

      // Accordion Toggle
      window.toggleAccordion = function (id) {
        const content = document.getElementById(`content-${id}`);
        const icon = document.getElementById(`icon-${id}`);

        if (content.classList.contains("open")) {
          content.classList.remove("open");
          content.style.maxHeight = "0px";
          icon.classList.remove("open");
        } else {
          content.classList.add("open");
          content.style.maxHeight = content.scrollHeight + "px";
          icon.classList.add("open");
        }
      };

      window.toggleTopic = function (catTitle, topicName) {
        if (window.dbToggleTopic) {
          window.dbToggleTopic(window.currentExamId, topicName);
        } else {
          console.error("Link severed.");
        }
      };

      window.updateTotalProgress = function (fullSyllabusArray) {
        let totalTopics = 0;
        let completedTopics = 0;
        const allProgress = window.getGlobalProgress
          ? window.getGlobalProgress()
          : {};
        const examProgress = allProgress[window.currentExamId] || {};

        fullSyllabusArray.forEach((cat) => {
          cat.topics.forEach((t) => {
            totalTopics++;
            if (examProgress[t]) completedTopics++;
          });
        });
        const percent =
          totalTopics === 0
            ? 0
            : Math.round((completedTopics / totalTopics) * 100);
        window.updateProgressUI(percent);
      };

      window.resetCurrentProgress = function () {
        if (window.dbResetExam) {
          window.dbResetExam(window.currentExamId);
        }
      };

      window.switchView = function (view) {
        currentView = view;
        const btnP = document.getElementById("btn-pattern");
        const btnS = document.getElementById("btn-syllabus");
        const divP = document.getElementById("view-pattern");
        const divS = document.getElementById("view-syllabus");

        // Wayne Tech Button Styles
        const activeClass =
          "bg-primary text-black shadow-[0_0_15px_var(--gold-glow)] font-bold scale-105";
        const inactiveClass =
          "text-textMuted hover:text-text hover:bg-surfaceHighlight";

        if (view === "pattern") {
          if (btnP)
            btnP.className = `flex-1 md:flex-none px-8 py-2.5 rounded-lg text-sm transition-all duration-300 ${activeClass}`;
          if (btnS)
            btnS.className = `flex-1 md:flex-none px-8 py-2.5 rounded-lg text-sm font-medium transition-all duration-300 ${inactiveClass}`;
          if (divP) divP.classList.remove("hidden");
          if (divS) divS.classList.add("hidden");
        } else {
          if (btnS)
            btnS.className = `flex-1 md:flex-none px-8 py-2.5 rounded-lg text-sm transition-all duration-300 ${activeClass}`;
          if (btnP)
            btnP.className = `flex-1 md:flex-none px-8 py-2.5 rounded-lg text-sm font-medium transition-all duration-300 ${inactiveClass}`;
          if (divS) divS.classList.remove("hidden");
          if (divP) divP.classList.add("hidden");
        }
      };

      init();
    </script>
  </body>
</html>
